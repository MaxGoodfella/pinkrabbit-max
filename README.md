## О задании
Данный проект представляет собой программу, которая может обрабатывать поступающие задачи через RabbitMQ, 
эффективно распределяя их между консьюмерами и обеспечивая устойчивость к сбоям.

Программа разбита на 2 модуля (микросервиса):
- **producer**;
- **consumer**. 

*Стек технологий:* Java 17, Spring Boot 3, Lombok, JUnit, Mockito, Postman, REST API, Docker, RabbitMQ, Prometheus, 
Grafana.

## Функциональность

1) **POST /send** - отправляет сообщение с возможностью указания задержки.
   * Метод принимает сообщение в теле запроса и параметр задержки в миллисекундах. 
   * Если задержка не указана, она по умолчанию равна 0.
   * Отправляет сообщение с использованием сервиса producerService, который обрабатывает задержку и отправку сообщения на RabbitMQ.
2) **GET /health** - проверяет состояние приложения.
   * Метод возвращает строку "OK", подтверждая, что приложение работает.
3) **PUT /consumer/prefetch** - обновляет количество сообщений, которое потребитель может забрать за один раз.
   * Принимает параметр count, который указывает новое значение для prefetchCount. 
   * Если значение count меньше 1, возвращает ошибку.
   * Обновляет конфигурацию потребителя и перезапускает его для применения нового значения prefetchCount.
4) **GET /consumer/prefetch** - получает текущее значение количества сообщений, которое потребитель может забрать за один раз.
   * Возвращает текущее значение prefetchCount для мониторинга и диагностики.

## Запуск приложения

Приложение поднимается через docker-compose, который содержит 5 контейнеров - 2 модуля бизнес-логики, 
RabbitMQ, Prometheus и Grafana.

**Порядок запуска приложения:**
1. *Клонирование репозитория*
```
git clone https://github.com/MaxGoodfella/pinkrabbit-max
cd pinkrabbit-max
```
2. *Запуск контейнеров используя Makefile*
```
make restart1
```
- Это действие удалит все созданные контейнеры, пересоберёт проект с помощью Maven и поднимет 4 контейнера - 
rabbitmq, producer, prometheus и grafana.
- Для перезапуска в дальнейшем можно смело использовать напрямую без отдельного ``` docker-compose down ```.
- Отправляем запрос с сообщением POST /send.
```
make restart2
```
- Это действие запустит контейнер consumer, который сразу получит отправленное ранее сообщение. 

3. *Запуск коллекции запросов*

Коллекция postman-запросов доступна в папке postman. 

4. *Просмотр метрик*
- **RabbitMQ Management UI** здесь http://localhost:15672
- **Список метрик** здесь http://localhost:15692/metrics
- **Prometheus** будет доступен здесь http://localhost:9090
- **Grafana** будет доступна здесь http://localhost:3000 (default - user: 'admin', password: 'admin')